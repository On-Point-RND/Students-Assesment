[name] [surname] [email]
[location]
[compaany]
+2 *** *** ***
[email]
Problem statement
Image registration is the transformation of one of the two images that the position and form of the objects in them
are aligneed
Formal problem statement:
ğœ™ = ğ‘ğ‘Ÿğ‘” minâ„’ ğ‘“, ğ‘š, ğœ™
ğœ™
ğ‘“ â€“ fixed image; ğ‘š â€“ moving image;
ğœ™ â€“ deformation field; â„’ âˆ’ loss function.
An example of registration of two
brain images.
In the left image:
Fixed image in red
Non-rigid
Moving image in blue
Registration
In the right image:
Fixed image in red
Registered (moved) image in blue
Variational form of the image registration problem
â€¢ The common loss functional for image registration task in discrete case can be written as:
1 1
2
â„’ ğœ™ = à· ğ· ğ’‘ + à· âˆ‡ğœ™ ğ’‘ ,
ğ‘“,ğ‘š ğ‘“,ğ‘š ğ‘– ğ‘–
|Î©| ğœ™ |Î© |
ğ‘
ğ’‘ âˆˆÎ© ğ’‘ âˆˆÎ©
ğ‘– ğ‘ ğ‘– ğ‘
where ğ‘“ is the fixed image, ğ‘š is the moving image, ğ‘š is the moved image, ğœ™ ğ’™ = (ğœ™ ğ’™ , ğœ™ ğ’™ ) is the
ğœ™ 1 2
2
deformation field, ğ· is the discrepancy, e.g. ğ· ğ’‘ = ğ‘“ ğ’‘ âˆ’ ğ‘š ğ’‘ , the second term is the
ğ‘“,ğ‘š ğ‘“,ğ‘š ğ‘– ğ‘– ğœ™ ğ‘–
ğœ™ ğœ™
regularization term, and ğœ† is the regularization parameter.
â€¢ In continuous case, we can rewrite the loss functional in an integral form as
2 2 2 2
ğœ•ğœ™ ğœ•ğœ™ ğœ•ğœ™ ğœ•ğœ™
áˆ˜ 1 1 2 2
â„’ ğœ™ = à¶± ğ· + ğœ† + + + ğ‘‘ğ‘¥ ğ‘‘ğ‘¥ .
ğ‘“,ğ‘š ğ‘“,ğ‘š 1 2
ğœ™ ğœ•ğ‘¥ ğœ•ğ‘¥ ğœ•ğ‘¥ ğœ•ğ‘¥
Î© 1 2 1 2
áˆ˜
â€¢ The Euler-Lagrange equations of the â„’ ğœ™ Õœmin minimization problem reduce to:
ğ‘“,ğ‘š
ğœ™
The optimal deformation field is the solution of this PDE system. â†’ we can
ğœ•ğ· ğœ•ğ·
ğ‘“,ğ‘š ğ‘“,ğ‘š apply neural operators to approximate the solution operator of this
ğœ™ ğœ™
âˆ’ 2ğœ† â‹… Î”ğœ™ = 0; âˆ’ 2ğœ† â‹… Î”ğœ™ = 0
1 2 equation.
ğœ•ğœ™ ğœ•ğœ™
1 2
Neural network-based image registration
In neural network-based image registration the model
predicts the deformation field â€“ the difference of
coordinates of each pixel in the initial and registered
image.
Typical CNN-based registration model architecture
Usually, the neural network is the CNN or
transformer model.
Problem â€“ CNN or transformers can efficiently
work only on the resolution at which the model
was trained.
VoxelMorph model architecture
Fourier Neural Operator (FNO)
FNO model is a deep learning model for
approximation of continuous non-linear
differential operators.
Above, we have reduced the image
registration problem to solving the parametric
system of PDEs â†’ we can apply FNO.
FNO model architecture
All operations in the FNO are applied to the fixed sub-domain in the Fourier space â†’ the model is robusst to the
input data resolution.
The main idea of the work: enhance the FNO model and evaluate it on the image registration at different
reresolutions.
Proposed model: FNOReg
Improvements of FNOReg compared to FNO:
â€¢ Additional skip-connectionsafter each Fourier block;
â€¢ Spectral Transform layers in the begiinnig and end of the model.
Spectral Transform is a non-local convolutional operator,
which is used to extract the features.
Spectral Transform Layer
FNOReg model Fourier Layer
OASIS-1 2D/3D dataset
OASIS 2D: 414 2D slices and their segmentation masks from
correspondiing 3D volumes.
Train: 201 images, 40200 pairs; Validation: 12 images, 22 pairs;
Test: 201 images, 400 pairs
OASIS 3D: 414 brain MRI with segmentation masks of important
anatomical areas.
Train: 384 images, 766 pairs; Validation: 10 images, 9 pairs; Test:
20 images, 19 pairs
2D OASIS-1 image examples
Evaluation metrics:
1. Average Dice score;
2. The percentage of voxels with a negative value of the Jacobian
determinant of the deformation field (so-called "folded voxels")
Vertical slices of OASIS-1 3D images with segmentation masks
Results
OA 2D DSC OASIS 3D DSC
All models were trained at original resolution and at half-resolution.
And evaluated at original resolution.
Results summary:
â— FNO-based registration models lose not more than 3% when training on half-resolution data. CNNs and
transformeers lose from 6% to 25%.
Results
OA 2D â€œFolded voxelsâ€ OA 3D â€œFolded voxelsâ€
Results summary:
â— FNOReg model has the best absolute values for the â€œfolded voxelsâ€ metric
among the methods that do not show significant degradaion in the
deformation field smoothneess at halved resolution;
â— FNOReg performs better than original FNO and learns faster and more stable.
Results
Fixed and moved images
Deformaation fields
Deformaation fields spectr
Spectra of deformation fields (DF) of VoxelMorph and TransMorph contain high-frequence components (cross-like)
Fourier-Net has explicit low-pass filtering in frequency domain which leads to aliasing.
DF produced by FNO-based models do not contain significant high frequency components â†’ the models give
smoother DF and are better in practice.
Conclusion
â€¢ We proposed a resolution-robusst metho for 2D and 3D image registration based on the Fourier Neural Operator.
â€¢ Assume we have an equation ğ¿ğ‘¢ ğ‘¥ = ğ‘“ ğ‘¥ , where ğ¿ is a linear differenÈ›ial operator and ğ‘¥ âˆˆ Î© âŠ‚ â„ ğ‘›, then
the solution can be found using the Greenâ€™s function ğº ğ‘¥, ğ‘  :
ğ‘¢ ğ’™ = à¶± ğº ğ’™, ğ’” ğ‘“ ğ’” ğ‘‘ğ‘  .
ğº
â€¢ The idea of FNO is that ğ‘¢ ğ‘¥ can be approxiated using the following iterative process:
ğ‘¢ ğ’™ âˆ¶= ğœ ğ‘Š ğ‘¢ ğ’™ + ğ¾ğ‘¢ ğ’™ , ğ‘¡ = 0, â€¦ğ‘ âˆ’ 1,
ğ‘¡+1 ğ‘¡ ğ‘¡ ğ‘¡
ğ¾ğ‘¢ ğ‘¥ = à¶± ğœ… ğ‘¥ âˆ’ ğ‘  ğ‘“ ğ‘  ğ‘‘ğ‘ 
ğ‘¡ ğ‘¡
Î©
where ğ‘¢ ğ‘¥ âˆˆ â„ ğ‘¢ğ‘¡ is the function of ğ‘¥, ğ‘Š âˆˆ â„ ğ‘¢ğ‘¡+1 ğ‘¢ğ‘¡ is a learnable linear transformation, ğœ â‹… is the
ğ‘¡ ğ‘¡
activation function, and ğœ… ğ‘¥ âˆ’ ğ‘  is a learnable kernel function of convolutional operator ğ¾. So ğ‘¢ ğ‘¥ is a kind of
ğ‘¡ ğ‘¡
a network hidden layer output with ğ‘‘ data channels.
â€¢ We can apply convolution theorem and parametrize ğ¾ in Fourier space:
âˆ’1 âˆ’1
ğ¾ğ‘¢ ğ’™ = â„± â„± ğ‘¢ âˆ™ â„± ğœ… = â„± â„± ğ‘¢ âˆ™ ğ‘… .
ğ‘¡ ğ‘¡ ğ‘¡ ğ‘¡ ğ‘¡
where ğ‘… ğ’Œ âˆˆ â„‚ ğ‘‘ ğ‘¢ğ‘¡+1 Ã—ğ‘‘ ğ‘¢ğ‘¡ is a learnable function in spectral domain and ğ’Œ = ğ‘˜ , â€¦, ğ‘˜ âˆˆ â„• ğ’ corresponds to non-
1 ğ‘›
negative frequencies.